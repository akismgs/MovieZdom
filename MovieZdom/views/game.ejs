<!DOCTYPE html>
<html lang="el">
  <head>
    <meta charset="UTF-8">
    <title>MovieZdom - Το Παιχνίδι Ξεκίνησε!</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { background-color: #1a1a2e; color: white; overflow: hidden; }
      h2 { color: white !important; }
      .timer-container { height: 8px; width: 100%; background: #16213e; position: fixed; top: 0; left: 0; }
      .timer-bar { height: 100%; width: 100%; background: #e94560; transition: width 0.1s linear; }
      .question-info { color: #ffffff !important; font-weight: bold; font-size: 1.2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
      .score-info { color: #ffd700 !important; font-weight: bold; font-size: 1.2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
      #statusMsg { 
        color: #00ffff !important; 
        font-weight: 900 !important; 
        font-size: 2rem !important; 
        text-shadow: 3px 3px 8px rgba(0,0,0,1), 0 0 20px rgba(0,255,255,0.9), 0 0 40px rgba(0,255,255,0.7) !important;
        padding: 15px !important;
        border-radius: 8px !important;
        letter-spacing: 1px !important;
      }
      #statusMsg.wrong-answer { 
        color: #ff0000 !important; 
        text-shadow: 3px 3px 8px rgba(0,0,0,1), 0 0 25px rgba(255,0,0,1), 0 0 50px rgba(255,0,0,0.8) !important; 
        font-size: 2.5rem !important;
      }
      #statusMsg.correct-answer { 
        color: #00ff00 !important; 
        text-shadow: 3px 3px 8px rgba(0,0,0,1), 0 0 25px rgba(0,255,0,1), 0 0 50px rgba(0,255,0,0.8) !important; 
        font-size: 2.5rem !important;
      }
      .option-btn {
        background: linear-gradient(135deg, #0f3460, #1a1a2e); border: 3px solid #ffb703; color: #ffffff !important;
        padding: 20px; border-radius: 10px; cursor: pointer; transition: 0.3s;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        font-weight: 900 !important;
        font-size: 1.2rem !important;
        text-shadow: 2px 2px 4px rgba(0,0,0,1), 0 0 10px rgba(255,255,255,0.5) !important;
      }
      .option-btn:hover {
        background: linear-gradient(135deg, #16213e, #0f3460);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.4);
      }
      .option-selected {
        background: linear-gradient(135deg, #fca311, #ffb703) !important;
        border-color: #ff6b35 !important;
        color: #000000 !important;
        box-shadow: 0 0 15px rgba(252, 163, 17, 0.5);
      }
      .option-correct {
        background: linear-gradient(135deg, #2a9d8f, #4a7c59) !important;
        border-color: #e9c46a !important;
        color: #ffffff !important;
        box-shadow: 0 0 15px rgba(42, 157, 143, 0.5);
      }
      .option-wrong {
        background: linear-gradient(135deg, #e63946, #b91c1c) !important;
        border-color: #ff6b35 !important;
        color: #ffffff !important;
        box-shadow: 0 0 15px rgba(230, 57, 70, 0.5);
      }

      #questionText {
        color: #ffffff !important;
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(15, 30, 50, 0.95)) !important;
        backdrop-filter: blur(20px) !important;
        padding: 30px !important;
        border-radius: 15px !important;
        border: 3px solid #ffb703 !important;
        text-shadow: 3px 3px 8px rgba(0,0,0,1), 0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(255,255,255,0.6), 0 0 60px rgba(255,255,255,0.4) !important;
        font-weight: 900 !important;
        font-size: 2rem !important;
        box-shadow: 0 0 30px rgba(255, 255, 0, 0.5), inset 0 0 20px rgba(255, 255, 0, 0.1) !important;
        margin: 20px 0 !important;
        line-height: 1.5 !important;
        letter-spacing: 0.5px !important;
      }
      
      #countdown-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); display: flex; justify-content: center;
        align-items: center; z-index: 2000; font-size: 10rem; font-weight: bold;
        color: #ffd700 !important; text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 4px 4px 10px rgba(0,0,0,1) !important;
      }
    </style>
  </head>
  
  <body>

    <div id="countdown-overlay">3</div>

    <div class="timer-container">
      <div id="timerBar" class="timer-bar"></div>
    </div>

    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8 text-center">
          <div class="d-flex justify-content-between mb-4">
            <span class="question-info">Ερώτηση: <span id="qIndex">1</span>/10</span>
            <span class="score-info">Score: <span id="myScore">0</span></span>
          </div>
          <h2 id="questionText" class="mb-5" style="color: #ffffff !important; text-shadow: 3px 3px 8px rgba(0,0,0,1), 0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(255,255,255,0.6) !important;">Φόρτωση ερώτησης...</h2>
          <div id="optionsGrid" class="row g-3"></div>
          <p id="statusMsg" class="mt-4"></p>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const lobbyId = "<%= lobbyId %>";
      let myScore = 0;

      // Σύνδεση στο δωμάτιο
      socket.emit('joinGame', lobbyId);

      // 1. Αντίστροφη μέτρηση πριν την έναρξη
      socket.on('startCountdown', () => {
        let count = 3;
        const overlay = document.getElementById('countdown-overlay');
        const interval = setInterval(() => {
          count--;
          if(count === 0) {
            overlay.innerText = "Πάμε!";
          } else if(count < 0) {
            clearInterval(interval);
            overlay.style.display = 'none';
          } else {
            overlay.innerText = count;
          }
        }, 1000);
      });

      // 2. Εμφάνιση Ερώτησης
      socket.on('newQuestion', (data) => {
        document.getElementById('qIndex').innerText = data.index + 1;
        const questionEl = document.getElementById('questionText');
        questionEl.innerText = data.question;
        questionEl.style.color = '#ffff00';
        questionEl.style.textShadow = '3px 3px 8px rgba(0,0,0,1), 0 0 20px rgba(255, 255, 0, 0.8), 0 0 40px rgba(255, 255, 0, 0.6), 0 0 60px rgba(255, 255, 0, 0.4)';
        questionEl.style.fontWeight = '900';
        const grid = document.getElementById('optionsGrid');
        grid.innerHTML = '';
        const statusMsg = document.getElementById('statusMsg');
        statusMsg.innerText = "Επιλέξτε απάντηση!";
        statusMsg.className = "mt-4";
        
        // Επαναφορά μπάρας χρόνου
        const bar = document.getElementById('timerBar');
        bar.style.transition = 'none';
        bar.style.width = '100%';
        setTimeout(() => {
          bar.style.transition = 'width 15s linear';
          bar.style.width = '0%';
        }, 50);

        data.options.forEach(opt => {
          const btn = document.createElement('div');
          btn.className = 'col-6';
          btn.innerHTML = `<div class="option-btn" onclick="selectOption(this, '${opt}')">${opt}</div>`;
          grid.appendChild(btn);
        });
      });

      function selectOption(el, val) {
        // Απενεργοποίηση άλλων επιλογών
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.style.pointerEvents = 'none');
        el.classList.add('option-selected');
        
        socket.emit('submitAnswer', { lobbyId, answer: val });
        const statusMsg = document.getElementById('statusMsg');
        statusMsg.innerText = "Περιμένοντας τον αντίπαλο...";
        statusMsg.className = "mt-4";
      }

      // 3. Αποτέλεσμα Ερώτησης
      socket.on('revealResult', (data) => {
        const btns = document.querySelectorAll('.option-btn');
        const statusMsg = document.getElementById('statusMsg');
        
        btns.forEach(btn => {
          if(btn.innerText === data.correctAnswer) {
            btn.classList.add('option-correct');
            btn.classList.remove('option-selected');
          } else if(btn.classList.contains('option-selected')) {
            btn.classList.add('option-wrong');
          }
        });

        if(data.isCorrect) {
          myScore += 3;
          document.getElementById('myScore').innerText = myScore;
          statusMsg.innerText = "ΣΩΣΤΟ!";
          statusMsg.className = "mt-4 correct-answer";
        } else {
          statusMsg.innerText = "ΛΑΘΟΣ!";
          statusMsg.className = "mt-4 wrong-answer";
        }
      });
    </script>
  </body>
</html>